/*
    *
    * Wijmo Library 5.20151.48
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    * 
    * Licensed under the Wijmo Commercial License. 
    * sales@wijmo.com
    * http://wijmo.com/products/wijmo-5/license/
    *
    */
var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},wijmo;(function(n){(function(t){(function(i){"use strict";var r=function(i){function r(r,u){var e,o,f;i.call(this,r);this._hideGroupedCols=!0;this._maxGroups=6;e="Missing dependency: GroupPanel requires ";n.assert(t.FlexGrid!=null,e+"wijmo.grid.");o=this.getTemplate();this.applyTemplate("wj-grouppanel wj-control",o,{_divMarkers:"div-markers",_divPH:"div-ph"});f=this.hostElement;f.addEventListener("dragstart",this._dragStart.bind(this));f.addEventListener("dragover",this._dragOver.bind(this));f.addEventListener("drop",this._drop.bind(this));f.addEventListener("dragend",this._dragEnd.bind(this));f.addEventListener("click",this._click.bind(this));this.initialize(u)}return __extends(r,i),Object.defineProperty(r.prototype,"hideGroupedColumns",{get:function(){return this._hideGroupedCols},set:function(t){t!=this._hideGroupedCols&&(this._hideGroupedCols=n.asBoolean(t))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxGroups",{get:function(){return this._maxGroups},set:function(t){t!=this._maxGroups&&(this._maxGroups=n.asNumber(t))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"placeholder",{get:function(){return this._divPH.textContent},set:function(n){this._divPH.textContent=n},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"grid",{get:function(){return this._g},set:function(i){this._g&&(this._g.draggingColumn.removeHandler(this._draggingColumn),this._g.itemsSourceChanged.removeHandler(this._itemsSourceChanged),this._g.sortedColumn.removeHandler(this.invalidate));this._g=n.asType(i,t.FlexGrid,!0);this._g&&(this._g.draggingColumn.addHandler(this._draggingColumn,this),this._g.itemsSourceChanged.addHandler(this._itemsSourceChanged,this),this._g.sortedColumn.addHandler(this.invalidate,this));this._itemsSourceChanged(this._g,null)},enumerable:!0,configurable:!0}),r.prototype.refresh=function(){var e,r,o,u,t,f,s;if(i.prototype.refresh.call(this),this._divMarkers.innerHTML="",this._dragMarker=this._dragCol=null,this._gds){for(e=this._g.sortRowIndex?this._g.sortRowIndex:this._g.columnHeaders.rows.length-1,r=0;r<this._gds.length;r++)o=this._gds[r],u=this._g.columns.getColumn(o.propertyName),u&&(t=document.createElement("div"),this._g.cellFactory.updateCell(this._g.columnHeaders,e,u.index,t),t.setAttribute("class","wj-cell wj-header wj-groupmarker"),n.setCss(t,{position:"static",display:"inline-block",verticalAlign:"top",left:"",top:"",right:"",height:"auto",width:"auto"}),f=t.querySelector("[wj-filter]"),f&&t.removeChild(f),s=n.createElement('<span wj-remove="" style="font-weight:normal;cursor:pointer">&nbsp;&times;&nbsp;<\/span>'),t.appendChild(s),this._divMarkers.appendChild(t));this._divMarkers.children.length>0?(this._divPH.style.display="none",this._divMarkers.style.display=""):(this._divPH.style.display="",this._divMarkers.style.display="none")}},r.prototype._addGroup=function(t,i){for(var f=this._getIndex(i),u=this._gds,r=0;r<u.length;r++)if(u[r].propertyName==t.binding){u.removeAt(r);r<f&&f--;break}for(r=this.maxGroups-1;r<u.length;r++)u.removeAt(r),r<f&&f--;u.deferUpdate(function(){var i=new n.collections.PropertyGroupDescription(t.binding);u.insert(f,i)});this.hideGroupedColumns&&(t.visible=!1);this.invalidate()},r.prototype._moveGroup=function(n,t){var r=this._gds,u=this._getElementIndex(this._dragMarker),i=this._getIndex(t);i>u&&i--;i>=this._gds.length&&(i=this._gds.length);u!=i&&r.deferUpdate(function(){var n=r[u];r.removeAt(u);r.insert(i,n)})},r.prototype._removeGroup=function(n){var t=this._gds[n].propertyName,i=this._g.columns.getColumn(t);this._gds.removeAt(n);i.visible=!0},r.prototype._getIndex=function(n){for(var r,i=this._divMarkers.children,t=0;t<i.length;t++)if(r=i[t].getBoundingClientRect(),n.clientX<r.left+r.width/2)return t;return i.length},r.prototype._getElementIndex=function(n){for(var i=n.parentElement.children,t=0;t<i.length;t++)if(i[t]==n)return t;return-1},r.prototype._draggingColumn=function(n,t){var i=this._g.columns[t.col];this._dragCol=i.binding?i:null},r.prototype._itemsSourceChanged=function(){this._gds&&this._gds.collectionChanged.removeHandler(this._groupsChanged);this._gds=null;this._g.collectionView&&(this._gds=this._g.collectionView.groupDescriptions,this._gds.collectionChanged.addHandler(this._groupsChanged,this));this.invalidate()},r.prototype._groupsChanged=function(){this.invalidate()},r.prototype._dragStart=function(n){n.dataTransfer.effectAllowed="move";n.dataTransfer.setData("text","");this._dragMarker=n.target;this._dragCol=null},r.prototype._dragOver=function(n){var t=this._dragCol||this._dragMarker;t&&(n.dataTransfer.dropEffect="move",n.preventDefault())},r.prototype._drop=function(n){this._dragMarker?this._moveGroup(this._dragMarker,n):this._dragCol&&this._addGroup(this._dragCol,n)},r.prototype._dragEnd=function(){this._dragMarker=this._dragCol=null},r.prototype._click=function(t){for(var o=document.elementFromPoint(t.clientX,t.clientY),c=o.getAttribute("wj-remove")!=null,i=o,f,e,u,h;i.parentElement&&!n.hasClass(i,"wj-cell");)i=i.parentElement;if(n.hasClass(i,"wj-cell")){var s=this._getElementIndex(i),l=this._g.collectionView,r=l.sortDescriptions;if(c)this._removeGroup(s);else if(t.ctrlKey)r.clear(),this.invalidate();else{for(f=this._gds[s],e=!0,u=0;u<r.length;u++)if(r[u].property==f.propertyName){e=!r[u].ascending;break}h=new n.collections.SortDescription(f.propertyName,e);r.splice(0,r.length,h);this.invalidate()}}},r.controlTemplate='<div><div wj-part="div-ph" style="cursor:default;height:100%"><\/div><div wj-part="div-markers" style="cursor:default;height:100%"><\/div><\/div>',r}(n.Control);i.GroupPanel=r})(t.grouppanel||(t.grouppanel={}));var i=t.grouppanel})(n.grid||(n.grid={}));var t=n.grid})(wijmo||(wijmo={}))